## 启动代码

~~~source venv/bin/activate
source venv/bin/activate

python asr_gui.py

### 处理和优化字幕文件（SRT格式），通过自动语音识别（ASR）数据的分段合并与拆分，提高字幕的可读性和同步精度 
python main.py --srt_path test_data/李白.srt --save_path test_data/李白_merged.srt
~~~


## 1，自动安装

1. 克隆项目并进入目录

```
git clone https://github.com/bozoyan/AsrTools.git
cd AsrTools
```

1. 安装依赖

```
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt

```



AI编程说明：
在 asr_gui.py 文件中添加了 SRT 字幕优化功能。
向 asr_gui.py 文件中添加一个新的 SrtOptimizerWidget 类和一个 SrtOptimizerWorker 类，用于实现 SRT 文件的优化功能。同时，修改 MainWindow 类，将这个新的小部件作为新的界面添加进去，并放置在“关于”选项卡之前。
具体办法：
1. 1.
   新增 SRT 优化界面 ( SrtOptimizerWidget )：
   
   - 创建了一个新的界面，包含选择源 SRT 文件和指定优化后文件保存路径的功能。
   - 界面支持拖拽 SRT 文件，并会自动生成默认的保存文件名（例如 原文件名_merged.srt ）。
   - 添加了“开始处理”按钮和状态显示标签，方便您了解处理进度。
2. 2.
   新增 SRT 优化工作线程 ( SrtOptimizerWorker )：
   
   - 为了避免在处理文件时界面卡顿，我将优化操作放在一个独立的后台线程中执行。
   - 该线程会调用项目中的 main.py 脚本来完成核心的字幕优化逻辑。
3. 3.
   主窗口集成 ：
   
   - 在主窗口中添加了一个新的导航选项“SRT 优化”，点击即可进入新功能界面。它位于“ASR Processing”和“About”之间。




向 asr_gui.py 文件中添加一个声音API生成功能，用于实现GPT-SoVITS接口的声音生成。同时，修改 MainWindow 类，将这个新的小部件作为新的界面添加进去，并放置在“关于”选项卡之前。我已经在本地开启GPT-SoVITS的终端端口服务，声音代码的执行全在GPT-SoVITS终端，这个页面只需要调用http://127.0.0.1:9880/tts的 API 返回音频文件就可以。

终端虚拟环境测试代码./venv/bin/python asr_gui.py

# API接口代码为：

# http://127.0.0.1:9880/tts?text=输入需要语音合成的内容。&text_lang=zh&ref_audio_path=./output/slicer_opt/F2024.wav&prompt_lang=zh&prompt_text=人家补课补来补去的也就上了个鉴湖，他什么都不补课也能上鉴湖。

声音生成界面

1，第一行是多行的文本输入框，对应到 API 里面的text字段中。

2，下载返回的音频文件到output文件夹，用文件名用时间戳显示。

3，将历史记录一条条全部显示出来，每一条分成 3 个区块显示（文本、文件名、播放按钮），历史记录上，可以点击右键删除记录

4，界面最下方是声音生成按钮


# 终端执行命令：
# cd /Volumes/AI/AI/GPT-SoVITS && conda activate GPTSoVits && ./go-api_v2.command

# API接口代码为：
# http://127.0.0.1:9880/tts?text=输入需要语音合成的内容。&text_lang=zh&ref_audio_path=./output/slicer_opt/F2024.wav&prompt_lang=zh&prompt_text=人家补课补来补去的也就上了个鉴湖，他什么都不补课也能上鉴湖。&text_split_method=cut5&batch_size=1&media_type=wav&streaming_mode=true
# 切换GPT模型
# http://127.0.0.1:9880/set_gpt_weights?weights_path=GPT_weights_v2/f1027-e15.ckpt
# 切换Sovits模型
# http://127.0.0.1:9880/set_sovits_weights?weights_path=SoVITS_weights_v2/f1027_e8_s208.pth

